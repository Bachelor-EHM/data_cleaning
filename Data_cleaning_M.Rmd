---
title: "Data Cleaning"
author: "Matilde Jacobsen"
date: "10/12/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

#Importing packages

```{r}
pacman::p_load(tidyverse, jsonlite, rjson, data.table)

RStudio.Version()

```

#Load data
To do: Make a loop for loading the logfiles
```{r}
dataPath <- 'logfiles/'

read_files <- function(filename) {
    # load data
    file <- jsonlite::fromJSON(paste(dataPath,filename,sep=""), flatten=T)
    # combine all this data in one dataset
    data <- rbind(file)
    return(data)
}


data = dir(dataPath, pattern = "*.json") %>% 
  purrr::map_df(read_files)

data <- data %>% 
  select(c(-previous_color_chain,id, condition)) %>%
  rename(Chain = info.chain,
         Subject = info.subject,
         Generation = info.generation,
         Language = info.language,
         Condition = info.condition) %>% 
  mutate(condition_label=
    case_when(
      Condition ==2~"Naming transmission" ,
      Condition ==1~"No naming transmission"))

```

#Making color matching df
Filter rows containing color matching and selecting which rows to keep
NB: how to extract color [object Object]

```{r}
color_match_df <- data %>% 
  filter(test_part == 'matching') %>% 
  select(rt, Condition, condition_label, duration, Subject, Chain, Generation, Language, source_color.h, source_color.s, source_color.l, color.h, color.s, color.l) 
  
write_csv(color_match_df, "color_match.csv")
color_match_df[1,12]

color_match_df <- color_match_df %>% 
  group_by(generation, seed_color) %>% 
  filter(source_color.h) %>% 
  mutate(dh = min(abs(h_match-h_seed), 360-abs(h_match-h_seed)/180.0))



h_seed <- color_match_df %>% group_by(generation, seed_color) %>% filter(source_color.h)
h_match <- color_match_df %>% group_by(generation, seed_color) %>% filter(color.h)
dh = min(abs(h_match-h_seed), 360-abs(h_match-h_seed)/180.0)

```

#Making color naming df

```{r}
color_naming_df <- data %>% 
  filter(test_part == 'naming') %>% 
  select(condition_label, basic_colors, creative_name, Chain, Generation, Subject, Condition, Language, color_to_name.h, color_to_name.s, color_to_name.l) 

write_csv(color_match_df, "color_naming.csv")

```

