---
title: "Data Cleaning"
author: "Matilde Jacobsen"
date: "10/12/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

#Importing packages

```{r}
pacman::p_load(tidyverse, jsonlite, rjson)


RStudio.Version()
```

#Load data
To do: Make a loop for loading the logfiles
```{r}
dataPath <- 'logfiles/'
fileID <- 'session'

dataFile <- paste(dataPath,fileID,".json",sep="")
d1 <- jsonlite::fromJSON(dataFile, flatten=T) 
d1 <- d1 %>% 
  select(c(-previous_color_chain,id))
d2 <- jsonlite::fromJSON(paste(dataPath,"session2",".json",sep=""), flatten=T) 
d2 <- d2 %>% 
  select(c(-previous_color_chain,id))

df_all <- rbind(d1, d2)

```

#Cleaning columns
Renaming columns
To do: discuss wich and to what

```{r}
#Renaming columns
df2 <- df2 %>% 
  rename()
```

#Making color matching df
Filter rows containing color matching and selecting which rows to keep
NB: how to extract color [object Object]

```{r}
color_match_df <- df_all %>% 
  filter(test_part == 'matching') %>% 
  select(generation, trial_index, time_elapsed, subject, source_color, color, duration) %>% 
  mutate(hue_seed = c(0, 30, 60, 120, 180, 240, 270, 330, 0, 30, 60, 120, 180, 240, 270, 330),
         saturation_seed = rep(60, 16),
         hue_matched = c(2, 33, 66, 125, 189, 241, 268, 335, 1, 34, 62, 126, 184, 245, 267, 338),
         saturation_matched = c(62, 63, 66, 59, 58, 60, 61, 65, 64, 65, 68, 61, 62, 64, 66, 67))


#doing some math
v1 <- as.vector(c(0, 60, 50))
v2 <- as.vector(c(2, 62, 50))

x1 = (v1[2]/100) * cos(v1[1])
x2 = (v2[2]/100) * cos(v2[1])
y1 = (v1[2]/100) * sin(v1[1])
y2 = (v2[2]/100) * sin(v2[1])
z1 = v1[3]
z2 = v2[3]

deltaE = (x1-x2)^2 + (y1-y2)^2 + (z1-z2)^2


#insert randon HSL values for exploratory analysis
color_match_df %>% plot(saturation_matched ~ generation)

```

#Making color naming df

```{r}
color_naming_df <- df2 %>% 
  filter(test_part == 'naming') %>% 
  select(trial_index, time_elapsed, subject, responses) %>% 



color_naming_df$responses %>% str_extract(':"(.*)",')
color_naming_df$responses %>% str_extract(',"(.*)"\\}')
  
```

