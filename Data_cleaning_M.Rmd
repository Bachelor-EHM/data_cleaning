---
title: "Data Cleaning"
author: "Matilde Jacobsen"
date: "10/12/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

#Importing packages

```{r}
#Set working directory
setwd("/Users/matilde/Desktop/AU/Bachelor project/Color_matching/data_cleaning")
#Load packages
pacman::p_load(tidyverse, jsonlite, rjson, data.table)
#Downloead citations
RStudio.Version()
#Clean environment
rm(list = ls())
```

#Load data
Make a loop for loading the logfiles
```{r}
#specifying data path
dataPath <- 'logfiles/25-10-2020/'
#creating a list of files
list_files <- list.files(path = dataPath,
                         recursive = T,
                         pattern = "json$",
                         full.names = T)
# wmpty data fame with the correct column names
allData <- data.frame(matrix(ncol = 23, nrow = 0))
x <- c("test_part", "rt", "Condition", "Condition_label", "Subject", "Chain", "Generation", "Language", "Hue_source", "Saturation_source", "Lightness_source", "Hue_matched", "Saturation_matched", "Lighness_matched", "Color_label_source", "Color_label_matched", "Language", "basic_colors", "creative_name", "Hue_color_to_name", "Saturation_color_to_name", "Lightness_color_to_name", "Color_label_naming") 
colnames(allData) <- x


for (i in 1:length(list_files)){

  filePath <- list_files[i]
  
  d <- jsonlite::fromJSON(filePath, flatten=T)
  
  d <- d %>% 
  rename(Chain = info.chain,
         Subject = info.subject,
         Generation = info.generation,
         Language = info.language,
         Condition = info.condition,
         Hue_source = source_color.h,
         Saturation_source = source_color.s,
         Lightness_source = source_color.l,
         Hue_matched = color.h,
         Saturation_matched = color.s,
         Lighness_matched = color.l,
         Color_label_matched = color.color_label,
         Color_label_source = source_color.color_label,
         Hue_color_to_name = color_to_name.h,
         Saturation_color_to_name = color_to_name.s,
         Lightness_color_to_name = color_to_name.l,
         Color_label_naming = color_to_name.color_label) %>% 
  mutate(Condition_label=
    case_when(
      Condition ==2~"Naming transmission" ,
      Condition ==1~"Pure transmission")) %>% 
    select(test_part, rt, Condition, Condition_label, Subject, Chain, Generation, Language, Hue_source, Saturation_source, Lightness_source, Hue_matched, Saturation_matched, Lighness_matched, Color_label_source, Color_label_matched, Language, basic_colors, creative_name, Hue_color_to_name, Saturation_color_to_name, Lightness_color_to_name, Color_label_naming) 
  
  if (nrow(allData) == 0){
    allData <- d
  } else{
    allData <- rbind(allData, d)
  }
  
}
```


#Making color matching df
Filter rows containing color matching and selecting which rows to keep

```{r}
color_matching <- allData %>% 
  filter(test_part == 'matching') %>% 
  select(rt, Condition, Condition_label, Subject, Chain, Generation, Language, Hue_source, Saturation_source, Lightness_source, Hue_matched, Saturation_matched, Lighness_matched, Color_label_source, Color_label_matched, Language) 

#Hues of each color 
red <- 12.2
yellow <- 62.4
green <- 136.5
blue <- 193.6

#Rename color labels to English and add focal wavelengths
color_matching <- color_matching %>% 
  filter(Language == "Danish") %>% 
  mutate(Color_label_matched = case_when(
          Color_label_matched == "seed sennepsgul"~"seed mustard",
          Color_label_matched == "seed græsgrøn" ~ "seed grass green",
          Color_label_matched == "seed havblå" ~ "seed ocean blue",
          Color_label_matched == "seed mørk rosa" ~ "seed dark rose"))
color_matching <- color_matching %>% 
  mutate(Focal = case_when(
          Color_label_matched == "seed mustard" ~ yellow,
          Color_label_matched == "seed grass green" ~ green,
          Color_label_matched == "seed ocean blue" ~ blue,
          Color_label_matched == "seed dark rose" ~ red))


#As factors cleaned
color_matching$Condition <- as.factor(color_matching$Condition)
color_matching$Chain <- as.factor(color_matching$Chain)
color_matching$Color_label_matched <- as.factor(color_matching$Color_label_matched)

write.csv(color_matching, file=paste("color_matching",Sys.Date(), sep = "", ".csv"))


```

#Making color naming df

```{r}
color_naming_df <- allData %>% 
  filter(test_part == 'naming') %>% 
  select(Condition_label, basic_colors, creative_name, Chain, Generation, Subject, Condition, Language, Hue_color_to_name, Saturation_color_to_name, Lightness_color_to_name, Color_label_naming) 


write.csv(color_naming_df, file=paste("color_naming",Sys.Date(),sep = "", ".csv"))

```

